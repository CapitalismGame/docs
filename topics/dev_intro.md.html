<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Capitalism Game Reference</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>Capitalism Game</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>




<h2>Articles</h2>
<ul class="">
  <li><strong>dev_intro</strong></li>
</ul>
<h2>Mods</h2>
<ul class="nowrap">
  <li><a href="../modules/audit.html">audit</a></li>
  <li><a href="../modules/banking.html">banking</a></li>
  <li><a href="../modules/company.html">company</a></li>
  <li><a href="../modules/land.html">land</a></li>
  <li><a href="../modules/shop.html">shop</a></li>
</ul>

</div>

<div id="content">

    <h1>Developer&rsquo;s Introduction</h1>

<p><a name="Code_Structure"></a></p>

<h2>Code Structure</h2>

<ul>
<li><strong>capitalism</strong> - mods specifically created for this game</li>
<li><strong>libs</strong> - libraries, don&rsquo;t add or change anything by default</li>
<li><strong>mtg</strong> - unmodified mtg mods</li>
<li>additional mods:</li>
</ul>


<pre>
* **crafting** - provides new crafting system
</pre>


<p><a name="Basic_Concepts"></a></p>

<h2>Basic Concepts</h2>

<p>A player belongs to zero, one, or more companies.
A player can act on behalf of only one company at
a time - this is their active company. The active company can be obtained using the following function:</p>

<pre>
<span class="keyword">local</span> comp = company.get_active(name)
</pre>


<h3>Actions and Permissions</h3>

<p>Actions include:</p>

<ul>
<li>Setting up craft networks and factories (<code>CREATE_FACTORY</code>, <code>EDIT_FACTORY</code>)</li>
<li>Making deals (<code>NEGOTIATE_TRADE</code>)</li>
<li>Making aquisitions (<code>NEGOTIATE_STOCK</code>)</li>
</ul>


<p>These actions are subject to having the appropriate permission:</p>

<pre>
<span class="keyword">if</span> <span class="keyword">not</span> comp:check_perm(name, perm_name, meta) <span class="keyword">then</span>
    <span class="global">error</span>(<span class="string">"can't do this!"</span>)
<span class="keyword">end</span>
</pre>


<p>Permissions can be granted by the CEO of a company to other
players at any time. This is done as part of the player tab
in the inventory formspec.</p>

<p>You can see a list of permissions and their meaning in
mods/capitalism/company/permissions.lua</p>

<p><a name="Data_Persistence"></a></p>

<h2>Data Persistence</h2>

<p>There&rsquo;s a helper available to save and load arrays of classes:</p>

<pre>
<span class="keyword">if</span> minetest <span class="keyword">then</span>
    <span class="keyword">local</span> storage = minetest.get_mod_storage()
    lib_utils.make_saveload(company, storage, <span class="string">"_companies"</span>, <span class="string">"add"</span>, company.Company)
    company.<span class="global">load</span>()
<span class="keyword">end</span>
</pre>


<p>make_saveload parameters:</p>

<ul>
<li><strong>tab</strong> - The mod&rsquo;s table.</li>
<li><strong>storage</strong> - ModStorageRef</li>
<li><strong>itemarraykey</strong> - Key for the table of object, <code>tab[itemarraykey]</code>.</li>
<li><strong>regkey</strong> - The add function, <code>tab[regkey]</code>.  Returns true on success.</li>
<li><strong>class</strong> - a reference to the class. Must have:</li>
</ul>


<pre>
* <span class="backtick"><code>:new()</code></span> with metatables <span class="keyword">and</span> initialisation
* from_table(), returns <span class="keyword">true</span> <span class="keyword">if</span> successful
* to_table(), returns <span class="global">table</span>
</pre>


<p><a name="Conventions"></a></p>

<h2>Conventions</h2>

<h3>Common Variable Names</h3>

<ul>
<li><code>name</code> - player name</li>
<li><code>comp</code> - company</li>
<li><code>cname</code> - company name</li>
<li><code>pname</code> - player name</li>
<li><code>area</code> - an <em>areas</em> area</li>
<li><code>acc</code> - bank account</li>
</ul>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2019-01-17 18:55:09 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
